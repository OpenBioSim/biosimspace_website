<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>BioSimSpace.IO._io - openbiosim - biosimspace</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_fonts.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_style.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom_pygments.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --font-stack: Changa, sans-serif;
  --font-stack--monospace: Roboto Mono, monospace;
  --color-foreground-primary: #dddddd;
  --color-foreground-secondary: #cccccc;
  --color-foreground-muted: #d0d0d0;
  --color-foreground-border: #923eb1;
  --color-background-primary: #160f30;
  --color-background-secondary: #201146;
  --color-background-hover: #4f4fb0;
  --color-background-hover--transparent: #4f4fb000;
  --color-background-border: #403333;
  --color-background-item: #411a30;
  --color-announcement-background: #000000dd;
  --color-announcement-text: #eeebee;
  --color-admonition-title-background--note: #FFFFFF33;
  --color-admonition-title-background--warning: #FF000033;
  --color-admonition-background: #FFFFFF11;
  --color-brand-primary: #eeeeee;
  --color-brand-content: #00dfef;
  --color-highlight-on-target: #333300;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">openbiosim - biosimspace</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/logo.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../compatibility.html">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart/index.html">Quick Start Guide</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/hydration_freenrg.html">Hydration free energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/metadynamics.html">Metadynamics</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../guides/index.html">Detailed Guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../guides/nodes.html">Nodes</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../guides/protocols.html">Protocols</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/index.html">API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Align.html">BioSimSpace.Align</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.generateNetwork.html">BioSimSpace.Align.generateNetwork</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.matchAtoms.html">BioSimSpace.Align.matchAtoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.rmsdAlign.html">BioSimSpace.Align.rmsdAlign</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.flexAlign.html">BioSimSpace.Align.flexAlign</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.merge.html">BioSimSpace.Align.merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Align.viewMapping.html">BioSimSpace.Align.viewMapping</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Box.html">BioSimSpace.Box</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.boxTypes.html">BioSimSpace.Box.boxTypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.generateBoxParameters.html">BioSimSpace.Box.generateBoxParameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.cubic.html">BioSimSpace.Box.cubic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.rhombicDodecahedronSquare.html">BioSimSpace.Box.rhombicDodecahedronSquare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.rhombicDodecahedronHexagon.html">BioSimSpace.Box.rhombicDodecahedronHexagon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Box.truncatedOctahedron.html">BioSimSpace.Box.truncatedOctahedron</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_FreeEnergy.html">BioSimSpace.FreeEnergy</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.FreeEnergy.Relative.html">BioSimSpace.FreeEnergy.Relative</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.FreeEnergy.engines.html">BioSimSpace.FreeEnergy.engines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.FreeEnergy.getData.html">BioSimSpace.FreeEnergy.getData</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Gateway.html">BioSimSpace.Gateway</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Node.html">BioSimSpace.Gateway.Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Boolean.html">BioSimSpace.Gateway.Boolean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Integer.html">BioSimSpace.Gateway.Integer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Float.html">BioSimSpace.Gateway.Float</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.String.html">BioSimSpace.Gateway.String</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.File.html">BioSimSpace.Gateway.File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.FileSet.html">BioSimSpace.Gateway.FileSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Length.html">BioSimSpace.Gateway.Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Area.html">BioSimSpace.Gateway.Area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Volume.html">BioSimSpace.Gateway.Volume</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Charge.html">BioSimSpace.Gateway.Charge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Energy.html">BioSimSpace.Gateway.Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Pressure.html">BioSimSpace.Gateway.Pressure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Temperature.html">BioSimSpace.Gateway.Temperature</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Gateway.Time.html">BioSimSpace.Gateway.Time</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_IO.html">BioSimSpace.IO</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.fileFormats.html">BioSimSpace.IO.fileFormats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.formatInfo.html">BioSimSpace.IO.formatInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.readMolecules.html">BioSimSpace.IO.readMolecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.readPDB.html">BioSimSpace.IO.readPDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.readPerturbableSystem.html">BioSimSpace.IO.readPerturbableSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.saveMolecules.html">BioSimSpace.IO.saveMolecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.IO.savePerturbableSystem.html">BioSimSpace.IO.savePerturbableSystem</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Metadynamics.html">BioSimSpace.Metadynamics</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.engines.html">BioSimSpace.Metadynamics.engines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.run.html">BioSimSpace.Metadynamics.run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.Bound.html">BioSimSpace.Metadynamics.Bound</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.Grid.html">BioSimSpace.Metadynamics.Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.Restraint.html">BioSimSpace.Metadynamics.Restraint</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/index_Metadynamics_CollectiveVariable.html">BioSimSpace.Metadynamics.CollectiveVariable</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.list.html">BioSimSpace.Metadynamics.CollectiveVariable.list</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.makeFunnel.html">BioSimSpace.Metadynamics.CollectiveVariable.makeFunnel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.viewFunnel.html">BioSimSpace.Metadynamics.CollectiveVariable.viewFunnel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.Distance.html">BioSimSpace.Metadynamics.CollectiveVariable.Distance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.Funnel.html">BioSimSpace.Metadynamics.CollectiveVariable.Funnel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.RMSD.html">BioSimSpace.Metadynamics.CollectiveVariable.RMSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/generated/BioSimSpace.Metadynamics.CollectiveVariable.Torsion.html">BioSimSpace.Metadynamics.CollectiveVariable.Torsion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_MD.html">BioSimSpace.MD</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.MD.engines.html">BioSimSpace.MD.engines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.MD.run.html">BioSimSpace.MD.run</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Node.html">BioSimSpace.Node</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Node.help.html">BioSimSpace.Node.help</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Node.list.html">BioSimSpace.Node.list</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Node.run.html">BioSimSpace.Node.run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Node.setNodeDirectory.html">BioSimSpace.Node.setNodeDirectory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Notebook.html">BioSimSpace.Notebook</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Notebook.plot.html">BioSimSpace.Notebook.plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Notebook.plotContour.html">BioSimSpace.Notebook.plotContour</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Notebook.plotOverlapMatrix.html">BioSimSpace.Notebook.plotOverlapMatrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Notebook.View.html">BioSimSpace.Notebook.View</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Parameters.html">BioSimSpace.Parameters</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.amberForceFields.html">BioSimSpace.Parameters.amberForceFields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.amberProteinForceFields.html">BioSimSpace.Parameters.amberProteinForceFields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.ff03.html">BioSimSpace.Parameters.ff03</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.ff14SB.html">BioSimSpace.Parameters.ff14SB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.ff99.html">BioSimSpace.Parameters.ff99</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.ff99SB.html">BioSimSpace.Parameters.ff99SB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.ff99SBildn.html">BioSimSpace.Parameters.ff99SBildn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.forceFields.html">BioSimSpace.Parameters.forceFields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.gaff.html">BioSimSpace.Parameters.gaff</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.gaff2.html">BioSimSpace.Parameters.gaff2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openForceFields.html">BioSimSpace.Parameters.openForceFields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_0_0.html">BioSimSpace.Parameters.openff_unconstrained_1_0_0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_0_0_RC1.html">BioSimSpace.Parameters.openff_unconstrained_1_0_0_RC1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_0_0_RC2.html">BioSimSpace.Parameters.openff_unconstrained_1_0_0_RC2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_0_1.html">BioSimSpace.Parameters.openff_unconstrained_1_0_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_1_0.html">BioSimSpace.Parameters.openff_unconstrained_1_1_0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_1_1.html">BioSimSpace.Parameters.openff_unconstrained_1_1_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_2_0.html">BioSimSpace.Parameters.openff_unconstrained_1_2_0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_2_1.html">BioSimSpace.Parameters.openff_unconstrained_1_2_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_3_0.html">BioSimSpace.Parameters.openff_unconstrained_1_3_0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_3_1.html">BioSimSpace.Parameters.openff_unconstrained_1_3_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_1_3_1_alpha_1.html">BioSimSpace.Parameters.openff_unconstrained_1_3_1_alpha_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_2_0_0.html">BioSimSpace.Parameters.openff_unconstrained_2_0_0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_2_0_0_rc_1.html">BioSimSpace.Parameters.openff_unconstrained_2_0_0_rc_1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.openff_unconstrained_2_0_0_rc_2.html">BioSimSpace.Parameters.openff_unconstrained_2_0_0_rc_2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.parameterise.html">BioSimSpace.Parameters.parameterise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Parameters.formalCharge.html">BioSimSpace.Parameters.formalCharge</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Process.html">BioSimSpace.Process</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.engines.html">BioSimSpace.Process.engines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.createProcess.html">BioSimSpace.Process.createProcess</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.Amber.html">BioSimSpace.Process.Amber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.Gromacs.html">BioSimSpace.Process.Gromacs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.Namd.html">BioSimSpace.Process.Namd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.OpenMM.html">BioSimSpace.Process.OpenMM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.Plumed.html">BioSimSpace.Process.Plumed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.Somd.html">BioSimSpace.Process.Somd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Process.ProcessRunner.html">BioSimSpace.Process.ProcessRunner</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Protocol.html">BioSimSpace.Protocol</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.protocols.html">BioSimSpace.Protocol.protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.createProtocol.html">BioSimSpace.Protocol.createProtocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Custom.html">BioSimSpace.Protocol.Custom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Equilibration.html">BioSimSpace.Protocol.Equilibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.FreeEnergy.html">BioSimSpace.Protocol.FreeEnergy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Metadynamics.html">BioSimSpace.Protocol.Metadynamics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Minimisation.html">BioSimSpace.Protocol.Minimisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Production.html">BioSimSpace.Protocol.Production</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Protocol.Steering.html">BioSimSpace.Protocol.Steering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/index_Sandpit.html">BioSimSpace.Sandpit</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Solvent.html">BioSimSpace.Solvent</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.solvate.html">BioSimSpace.Solvent.solvate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.spc.html">BioSimSpace.Solvent.spc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.spce.html">BioSimSpace.Solvent.spce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.tip3p.html">BioSimSpace.Solvent.tip3p</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.tip4p.html">BioSimSpace.Solvent.tip4p</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.tip5p.html">BioSimSpace.Solvent.tip5p</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Solvent.waterModels.html">BioSimSpace.Solvent.waterModels</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Trajectory.html">BioSimSpace.Trajectory</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Trajectory.Trajectory.html">BioSimSpace.Trajectory.Trajectory</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Types.html">BioSimSpace.Types</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Angle.html">BioSimSpace.Types.Angle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Area.html">BioSimSpace.Types.Area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Charge.html">BioSimSpace.Types.Charge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Coordinate.html">BioSimSpace.Types.Coordinate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Energy.html">BioSimSpace.Types.Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Length.html">BioSimSpace.Types.Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Pressure.html">BioSimSpace.Types.Pressure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Temperature.html">BioSimSpace.Types.Temperature</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Time.html">BioSimSpace.Types.Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Vector.html">BioSimSpace.Types.Vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Types.Volume.html">BioSimSpace.Types.Volume</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Units.html">BioSimSpace.Units</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Length.meter.html">BioSimSpace.Units.Length.meter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Length.angstrom.html">BioSimSpace.Units.Length.angstrom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Length.nanometer.html">BioSimSpace.Units.Length.nanometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Length.picometer.html">BioSimSpace.Units.Length.picometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Area.meter2.html">BioSimSpace.Units.Area.meter2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Area.angstrom2.html">BioSimSpace.Units.Area.angstrom2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Area.nanometer2.html">BioSimSpace.Units.Area.nanometer2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Area.picometer2.html">BioSimSpace.Units.Area.picometer2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Angle.radian.html">BioSimSpace.Units.Angle.radian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Angle.degree.html">BioSimSpace.Units.Angle.degree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Volume.meter3.html">BioSimSpace.Units.Volume.meter3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Volume.angstrom3.html">BioSimSpace.Units.Volume.angstrom3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Volume.nanometer3.html">BioSimSpace.Units.Volume.nanometer3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Volume.picometer3.html">BioSimSpace.Units.Volume.picometer3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Charge.electron_charge.html">BioSimSpace.Units.Charge.electron_charge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Charge.coulomb.html">BioSimSpace.Units.Charge.coulomb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Energy.kcal_per_mol.html">BioSimSpace.Units.Energy.kcal_per_mol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Energy.kj_per_mol.html">BioSimSpace.Units.Energy.kj_per_mol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Energy.kt.html">BioSimSpace.Units.Energy.kt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Pressure.atm.html">BioSimSpace.Units.Pressure.atm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Pressure.bar.html">BioSimSpace.Units.Pressure.bar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Temperature.kelvin.html">BioSimSpace.Units.Temperature.kelvin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Temperature.celsius.html">BioSimSpace.Units.Temperature.celsius</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Temperature.fahrenheit.html">BioSimSpace.Units.Temperature.fahrenheit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.day.html">BioSimSpace.Units.Time.day</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.hour.html">BioSimSpace.Units.Time.hour</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.minute.html">BioSimSpace.Units.Time.minute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.second.html">BioSimSpace.Units.Time.second</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.millisecond.html">BioSimSpace.Units.Time.millisecond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.nanosecond.html">BioSimSpace.Units.Time.nanosecond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.picosecond.html">BioSimSpace.Units.Time.picosecond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace.Units.Time.femtosecond.html">BioSimSpace.Units.Time.femtosecond</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Config.html">BioSimSpace._Config</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Config.Amber.html">BioSimSpace._Config.Amber</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Config.Gromacs.html">BioSimSpace._Config.Gromacs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Config.Somd.html">BioSimSpace._Config.Somd</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Exceptions.html">BioSimSpace._Exceptions</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.AlignmentError.html">BioSimSpace._Exceptions.AlignmentError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.AnalysisError.html">BioSimSpace._Exceptions.AnalysisError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.IncompatibleError.html">BioSimSpace._Exceptions.IncompatibleError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.MissingSoftwareError.html">BioSimSpace._Exceptions.MissingSoftwareError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.ParameterisationError.html">BioSimSpace._Exceptions.ParameterisationError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Exceptions.ThirdPartyError.html">BioSimSpace._Exceptions.ThirdPartyError</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_SireWrappers.html">BioSimSpace._SireWrappers</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.Atom.html">BioSimSpace._SireWrappers.Atom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.Bond.html">BioSimSpace._SireWrappers.Bond</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.Molecule.html">BioSimSpace._SireWrappers.Molecule</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.Molecules.html">BioSimSpace._SireWrappers.Molecules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.Residue.html">BioSimSpace._SireWrappers.Residue</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.System.html">BioSimSpace._SireWrappers.System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._SireWrappers.SearchResult.html">BioSimSpace._SireWrappers.SearchResult</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/index_Utils.html">BioSimSpace._Utils</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils.cd.html">BioSimSpace._Utils.cd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils.command_split.html">BioSimSpace._Utils.command_split</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils._module_stub.html">BioSimSpace._Utils._module_stub</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils._try_import.html">BioSimSpace._Utils._try_import</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils._have_imported.html">BioSimSpace._Utils._have_imported</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/BioSimSpace._Utils._assert_imported.html">BioSimSpace._Utils._assert_imported</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">How to ask for help</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../contributing/index.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../contributing/development.html">Developer’s guide</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/codestyle.html">Coding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/packaging.html">Packaging releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/roadmap.html">Roadmap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for BioSimSpace.IO._io</h1><div class="highlight"><pre>
<span></span><span class="c1">######################################################################</span>
<span class="c1"># BioSimSpace: Making biomolecular simulation a breeze!</span>
<span class="c1">#</span>
<span class="c1"># Copyright: 2017-2023</span>
<span class="c1">#</span>
<span class="c1"># Authors: Lester Hedges &lt;lester.hedges@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># BioSimSpace is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># BioSimSpace is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with BioSimSpace. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#####################################################################</span>

<span class="sd">&quot;&quot;&quot;Functionality for reading/writing molecular systems.&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Lester Hedges&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;lester.hedges@gmail.com&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;expand&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fileFormats&quot;</span><span class="p">,</span>
    <span class="s2">&quot;formatInfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;readMolecules&quot;</span><span class="p">,</span>
    <span class="s2">&quot;readPDB&quot;</span><span class="p">,</span>
    <span class="s2">&quot;readPerturbableSystem&quot;</span><span class="p">,</span>
    <span class="s2">&quot;saveMolecules&quot;</span><span class="p">,</span>
    <span class="s2">&quot;savePerturbableSystem&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span> <span class="k">as</span> <span class="n">_OrderedDict</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span> <span class="k">as</span> <span class="n">_glob</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span> <span class="k">as</span> <span class="n">_StringIO</span>

<span class="kn">import</span> <span class="nn">hashlib</span> <span class="k">as</span> <span class="nn">_hashlib</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="k">as</span> <span class="nn">_json</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">shlex</span> <span class="k">as</span> <span class="nn">_shlex</span>
<span class="kn">import</span> <span class="nn">shutil</span> <span class="k">as</span> <span class="nn">_shutil</span>
<span class="kn">import</span> <span class="nn">sys</span> <span class="k">as</span> <span class="nn">_sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">_subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span> <span class="k">as</span> <span class="nn">_tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span> <span class="k">as</span> <span class="nn">_warnings</span>

<span class="c1"># Wrap the import of PyPDB since it imports Matplotlib, which will fail if</span>
<span class="c1"># we don&#39;t have a display running.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pypdb</span> <span class="k">as</span> <span class="nn">_pypdb</span>

    <span class="n">_has_pypdb</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">_has_pypdb</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Flag that we&#39;ve not yet raised a warning about GROMACS not being installed.</span>
<span class="n">_has_gmx_warned</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">import</span> <span class="nn">sire</span> <span class="k">as</span> <span class="nn">_sire</span>

<span class="kn">from</span> <span class="nn">sire.legacy</span> <span class="kn">import</span> <span class="n">Base</span> <span class="k">as</span> <span class="n">_SireBase</span>
<span class="kn">from</span> <span class="nn">sire.legacy</span> <span class="kn">import</span> <span class="n">IO</span> <span class="k">as</span> <span class="n">_SireIO</span>
<span class="kn">from</span> <span class="nn">sire.legacy</span> <span class="kn">import</span> <span class="n">Mol</span> <span class="k">as</span> <span class="n">_SireMol</span>
<span class="kn">from</span> <span class="nn">sire.legacy</span> <span class="kn">import</span> <span class="n">System</span> <span class="k">as</span> <span class="n">_SireSystem</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">_amber_home</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">_gmx_path</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">_isVerbose</span>
<span class="kn">from</span> <span class="nn">.._Exceptions</span> <span class="kn">import</span> <span class="n">MissingSoftwareError</span> <span class="k">as</span> <span class="n">_MissingSoftwareError</span>
<span class="kn">from</span> <span class="nn">.._SireWrappers</span> <span class="kn">import</span> <span class="n">Molecule</span> <span class="k">as</span> <span class="n">_Molecule</span>
<span class="kn">from</span> <span class="nn">.._SireWrappers</span> <span class="kn">import</span> <span class="n">Molecules</span> <span class="k">as</span> <span class="n">_Molecules</span>
<span class="kn">from</span> <span class="nn">.._SireWrappers</span> <span class="kn">import</span> <span class="n">System</span> <span class="k">as</span> <span class="n">_System</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">_Utils</span>


<span class="c1"># Context manager for capturing stdout.</span>
<span class="c1"># Taken from:</span>
<span class="c1"># https://stackoverflow.com/questions/16571150/how-to-capture-stdout-output-from-a-python-function-call</span>
<span class="k">class</span> <span class="nc">_Capturing</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stdout</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringio</span> <span class="o">=</span> <span class="n">_StringIO</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stringio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stringio</span>
        <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdout</span>


<span class="c1"># Capture the supported format information</span>
<span class="k">with</span> <span class="n">_Capturing</span><span class="p">()</span> <span class="k">as</span> <span class="n">format_info</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">MoleculeParser</span><span class="o">.</span><span class="n">supportedFormats</span><span class="p">())</span>

<span class="c1"># Create a list of the supported formats.</span>
<span class="n">_formats</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Create a dictionary of format-description key:value pairs.</span>
<span class="n">_formats_dict</span> <span class="o">=</span> <span class="n">_OrderedDict</span><span class="p">()</span>

<span class="c1"># Loop over the format information to populate the dictionary.</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">format_info</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;Parser&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="n">format_info</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">format_info</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="o">!=</span> <span class="s2">&quot;SUPPLEMENTARY&quot;</span><span class="p">:</span>
            <span class="n">_formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
            <span class="n">_formats_dict</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>

<span class="c1"># Delete the redundant variables.</span>
<span class="k">del</span> <span class="n">format_info</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">description</span>


<span class="c1"># Initialise a &quot;cache&quot;. This maps system UIDs and formats that have previously</span>
<span class="c1"># been written to file. When saving, we can then check to see if a system has</span>
<span class="c1"># previously been written to the specified format and, if the file still exists</span>
<span class="c1"># and is unmodified, then we can simply copy to the new location.</span>
<span class="n">_file_cache</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expand the set of paths with the supplied base.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    base : str</span>
<span class="sd">        The base to prepend to all paths.</span>

<span class="sd">    path : str, [str]</span>
<span class="sd">        The filename (or names) that will be prepended with the base.</span>

<span class="sd">    suffix : str</span>
<span class="sd">        An optional suffix to append to all files, e.g. &quot;.bz2&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    path : [str]</span>
<span class="sd">        The list of expanded filenames or URLs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;base&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Convert single values to a list.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;path&#39; must be a list of &#39;str&#39; types.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;suffix&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_sire</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>


<div class="viewcode-block" id="fileFormats"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.fileFormats.html#BioSimSpace.IO.fileFormats">[docs]</a><span class="k">def</span> <span class="nf">fileFormats</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of the supported formats.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    formats : [str]</span>
<span class="sd">        A list of the support file formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_formats</span></div>


<div class="viewcode-block" id="formatInfo"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.formatInfo.html#BioSimSpace.IO.formatInfo">[docs]</a><span class="k">def</span> <span class="nf">formatInfo</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return information for the specified file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    format : str</span>
<span class="sd">        The file format.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    info : str</span>
<span class="sd">        A description of the named file format.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Display information regarding the PDB format.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; BSS.formatInfo(&quot;PDB&quot;)</span>

<span class="sd">    Print information for each of the supported file formats.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; for format in BSS.IO.fileFormats:</span>
<span class="sd">    ...     BSS.IO.formatInfo(format)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_formats_dict</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unsupported format: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="readPDB"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.readPDB.html#BioSimSpace.IO.readPDB">[docs]</a><span class="k">def</span> <span class="nf">readPDB</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">pdb4amber</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a molecular system from a Protein Data Bank (PDBP) ID in the RSCB PDB</span>
<span class="sd">    website.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    id : str</span>
<span class="sd">        The PDB ID string, or path to a PDB file.</span>

<span class="sd">    pdb4amber : bool</span>
<span class="sd">        Whether to process the PDB file using pdb4amber. This reformats the file</span>
<span class="sd">        such that it can be handled by the AMBER suite of tools.</span>

<span class="sd">    show_warnings : bool</span>
<span class="sd">        Whether to show any warnings raised during parsing of the input files.</span>

<span class="sd">    work_dir : str</span>
<span class="sd">        The working directory used to run pdb4amber.</span>

<span class="sd">    property_map : dict</span>
<span class="sd">        A dictionary that maps system &quot;properties&quot; to their user defined</span>
<span class="sd">        values. This allows the user to refer to properties with their</span>
<span class="sd">        own naming scheme, e.g. { &quot;charge&quot; : &quot;my-charge&quot; }</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    system : :class:`System &lt;BioSimSpace._SireWrappers.System&gt;`</span>
<span class="sd">        A molecular system.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Create a molecular system from the deoxy human haemoglobin Protein</span>
<span class="sd">    Data Bank (PDB) record.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readPDB(&quot;1a3n&quot;)</span>

<span class="sd">    Create a molecular system from a PDB file on disk and re-format so that</span>
<span class="sd">    it is compatible with the AmberTools suite.</span>
<span class="sd">    Data Bank (PDB) record.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readPDB(&quot;file.pdb&quot;, pdb4amber=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_pypdb</span><span class="p">:</span>
        <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;BioSimSpace.IO: PyPDB could not be imported on this system.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;id&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pdb4amber</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;pdb4amber&#39; must be of type &#39;bool&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;work_dir&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Create a temporary working directory and store the directory name.</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">_tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># User specified working directory.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use full path.</span>
        <span class="k">if</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">work_dir</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">work_dir</span>

        <span class="c1"># Create the directory if it doesn&#39;t already exist.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
            <span class="n">_os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Path to a PDB file.</span>
    <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
        <span class="n">pdb_file</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

    <span class="c1"># This is a URL.</span>
    <span class="k">elif</span> <span class="nb">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">)):</span>
        <span class="kn">from</span> <span class="nn">sire._load</span> <span class="kn">import</span> <span class="n">_resolve_path</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdb_file</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">work_dir</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to download PDB file: &#39;</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># ID from the Protein Data Bank.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_pypdb</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;BioSimSpace.IO: PyPDB could not be imported on this system.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Strip any whitespace from the PDB ID and convert to upper case.</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="c1"># Attempt to download the PDB file. (Compression is currently broken!)</span>
        <span class="k">with</span> <span class="n">_warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">pdb_string</span> <span class="o">=</span> <span class="n">_pypdb</span><span class="o">.</span><span class="n">get_pdb_file</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s2">&quot;pdb&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Retrieval failed, invalid PDB ID: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">)</span>

        <span class="c1"># Create the name of the PDB file.</span>
        <span class="n">pdb_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">.pdb&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

        <span class="c1"># Now write the PDB string to file.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdb_string</span><span class="p">)</span>

        <span class="c1"># Store the absolute path of the file.</span>
        <span class="n">pdb_file</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">)</span>

    <span class="c1"># Process the file with pdb4amber.</span>
    <span class="k">if</span> <span class="n">pdb4amber</span><span class="p">:</span>
        <span class="c1"># Check that pdb4amber exists.</span>
        <span class="k">if</span> <span class="n">_amber_home</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_MissingSoftwareError</span><span class="p">(</span>
                <span class="s2">&quot;Please install AmberTools for pdb4amber support: http://ambermd.org&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_pdb4amber_exe</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/bin/pdb4amber&quot;</span> <span class="o">%</span> <span class="n">_amber_home</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">_pdb4amber_exe</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Missing pdb4amber executable: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">_pdb4amber_exe</span><span class="p">)</span>

                <span class="c1"># Create the file prefix.</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">work_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

        <span class="c1"># Create the pdb4amber command.</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -o pdb4amber.pdb&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_pdb4amber_exe</span><span class="p">,</span> <span class="n">pdb_file</span><span class="p">)</span>

        <span class="c1"># Create files for stdout/stderr.</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;pdb4amber.out&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;pdb4amber.err&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="c1"># Run pdb4amber as a subprocess.</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">_Utils</span><span class="o">.</span><span class="n">command_split</span><span class="p">(</span><span class="n">command</span><span class="p">),</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">stderr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Check that the output PDB file was generated.</span>
        <span class="c1"># the expected output was generated.</span>
        <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/pdb4amber.pdb&quot;</span> <span class="o">%</span> <span class="n">work_dir</span><span class="p">):</span>
            <span class="n">pdb_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/pdb4amber.pdb&quot;</span> <span class="o">%</span> <span class="n">work_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;pdb4amber failed!&quot;</span><span class="p">)</span>

    <span class="c1"># Read the file and return a molecular system.</span>
    <span class="k">return</span> <span class="n">readMolecules</span><span class="p">(</span>
        <span class="n">pdb_file</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="n">show_warnings</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="readMolecules"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.readMolecules.html#BioSimSpace.IO.readMolecules">[docs]</a><span class="k">def</span> <span class="nf">readMolecules</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a molecular system from file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    files : str, [str]</span>
<span class="sd">        A file name, or a list of file names. Note that the file names can</span>
<span class="sd">        be URLs, in which case the files will be downloaded and (if necessary)</span>
<span class="sd">        extracted before reading.</span>

<span class="sd">    show_warnings : bool</span>
<span class="sd">        Whether to show any warnings raised during parsing of the input files.</span>

<span class="sd">    download_dir : str</span>
<span class="sd">        The directory to download files to. If None, then a temporary directory</span>
<span class="sd">        will be created for you.</span>

<span class="sd">    property_map : dict</span>
<span class="sd">        A dictionary that maps system &quot;properties&quot; to their user defined</span>
<span class="sd">        values. This allows the user to refer to properties with their</span>
<span class="sd">        own naming scheme, e.g. { &quot;charge&quot; : &quot;my-charge&quot; }</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    system : :class:`System &lt;BioSimSpace._SireWrappers.System&gt;`</span>
<span class="sd">        A molecular system.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Load a molecular system from AMBER coordinate and topology files.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules([&quot;ala.rst7&quot;, &quot;ala.prm7&quot;])</span>

<span class="sd">    Load the same system, but map the &quot;charge&quot; property to the key &quot;my-charge&quot;.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules([&quot;ala.rst7&quot;, &quot;ala.prm7&quot;], property_map={&quot;charge&quot; : &quot;my-charge&quot;})</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules([&quot;ala.rst7&quot;, &quot;ala.prm7&quot;])</span>

<span class="sd">    Load a molecular system from all of the files contained within a directory.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules(&quot;dir/*&quot;)</span>

<span class="sd">    Load a molecular system from GROMACS coordinate and topology files using</span>
<span class="sd">    a custom GROMACS topology directory.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules([&quot;mol.gro87&quot;, &quot;mol.grotop&quot;], property_map={&quot;GROMACS_PATH&quot; : &quot;/path/to/gromacs/topology&quot;})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">_has_gmx_warned</span>
    <span class="k">if</span> <span class="n">_gmx_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_has_gmx_warned</span><span class="p">:</span>
        <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;BioSimSpace.IO: Please install GROMACS (http://www.gromacs.org) &quot;</span>
            <span class="s2">&quot;for GROMACS topology file support.&quot;</span>
        <span class="p">)</span>
        <span class="n">_has_gmx_warned</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Glob string to catch wildcards and convert to list.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">)):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

    <span class="c1"># Check that all arguments are of type &#39;str&#39;.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;files&#39; must be a list of &#39;str&#39; types.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The list of input files is empty!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;files&#39; must be of type &#39;str&#39;, or a list of &#39;str&#39; types.&quot;</span><span class="p">)</span>

    <span class="c1"># Validate the warning message flag.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">show_warnings</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;show_warnings&#39; must be of type &#39;bool&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Validate the download directory.</span>
    <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;download_dir&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Use full path.</span>
        <span class="k">if</span> <span class="n">download_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">download_dir</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">download_dir</span>

        <span class="c1"># Create the directory if it doesn&#39;t already exist.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
            <span class="n">_os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create a temporary working directory and store the directory name.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">download_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">_tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
            <span class="n">download_dir</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># Validate the map.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">property_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;property_map&#39; must be of type &#39;dict&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Add the GROMACS topology file path.</span>
    <span class="k">if</span> <span class="n">_gmx_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;GROMACS_PATH&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">property_map</span><span class="p">):</span>
        <span class="n">property_map</span><span class="p">[</span><span class="s2">&quot;GROMACS_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gmx_path</span>

    <span class="c1"># Check that the files exist (if not a URL).</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Missing input file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">file</span><span class="p">)</span>

    <span class="c1"># Try to read the files and return a molecular system.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">_patch_sire_load</span><span class="p">(</span>
            <span class="n">files</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="n">download_dir</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span><span class="p">,</span>
            <span class="n">show_warnings</span><span class="o">=</span><span class="n">show_warnings</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e0</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;There are no lead parsers!&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e0</span><span class="p">):</span>
            <span class="c1"># First check to see if the failure was due to the presence</span>
            <span class="c1"># of CMAP records.</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">amber_prm</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">AmberPrm</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;CMAP&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Unable to parse AMBER topology file. CMAP &quot;</span>
                            <span class="s2">&quot;records are currently unsupported.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
                    <span class="k">elif</span> <span class="s2">&quot;CHAMBER&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Unable to parse AMBER topology file. &quot;</span>
                            <span class="s2">&quot;CHAMBER files are currently unsupported.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Failed to read molecules from </span><span class="si">%s</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;It looks like you failed to include a topology file.&quot;</span>
            <span class="p">)</span> <span class="o">%</span> <span class="n">files</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Incompatibility&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e0</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Incompatibility between molecular information in files: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">files</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to read molecules from: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">files</span>
                <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">return</span> <span class="n">_System</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div>


<div class="viewcode-block" id="saveMolecules"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.saveMolecules.html#BioSimSpace.IO.saveMolecules">[docs]</a><span class="k">def</span> <span class="nf">saveMolecules</span><span class="p">(</span><span class="n">filebase</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">fileformat</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a molecular system to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    filebase : str</span>
<span class="sd">        The base name of the output files.</span>

<span class="sd">    system : :class:`System &lt;BioSimSpace._SireWrappers.System&gt;`, \</span>
<span class="sd">             :class:`Molecule&lt; BioSimSpace._SireWrappers.Molecule&gt;` \</span>
<span class="sd">             :class:`Molecule&lt; BioSimSpace._SireWrappers.Molecules&gt;`</span>
<span class="sd">        The molecular system.</span>

<span class="sd">    fileformat : str, [str]</span>
<span class="sd">        The file format (or formats) to save to.</span>

<span class="sd">    property_map : dict</span>
<span class="sd">        A dictionary that maps system &quot;properties&quot; to their user</span>
<span class="sd">        defined values. This allows the user to refer to properties</span>
<span class="sd">        with their own naming scheme, e.g. { &quot;charge&quot; : &quot;my-charge&quot; }</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    files : [str]</span>
<span class="sd">        The list of files that were generated.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Load a molecular system from AMBER coordinate and topology files then</span>
<span class="sd">    try to save it to all supported file formats.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; files = BSS.IO.expand(BSS.tutorialUrl(), [&quot;ala.top&quot;, &quot;ala.crd&quot;], &quot;.bz2&quot;)</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules(files)</span>
<span class="sd">    &gt;&gt;&gt; for format in BSS.IO.fileFormats():</span>
<span class="sd">    ...     try:</span>
<span class="sd">    ...         BSS.IO.saveMolecules(&quot;test&quot;, system, format)</span>
<span class="sd">    ...     except:</span>
<span class="sd">    ...         print(&quot;Could not convert to format: &#39;%s&#39;&quot; % format)</span>

<span class="sd">    Load a molecular system from AMBER coordinate and topology files then</span>
<span class="sd">    try to save it to GROMACS format, mapping and un-mapping the charge</span>
<span class="sd">    property along the way.</span>

<span class="sd">    &gt;&gt;&gt; import BioSimSpace as BSS</span>
<span class="sd">    &gt;&gt;&gt; files = BSS.IO.expand(BSS.tutorialUrl(), [&quot;ala.top&quot;, &quot;ala.crd&quot;], &quot;.bz2&quot;)</span>
<span class="sd">    &gt;&gt;&gt; system = BSS.IO.readMolecules(files, property_map={&quot;charge&quot; : &quot;my-charge&quot;})</span>
<span class="sd">    &gt;&gt;&gt; BSS.IO.saveMolecules(&quot;test&quot;, system, [&quot;gro87&quot;, &quot;grotop&quot;], property_map={&quot;charge&quot; : &quot;my-charge&quot;})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">_has_gmx_warned</span>
    <span class="k">if</span> <span class="n">_gmx_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_has_gmx_warned</span><span class="p">:</span>
        <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;BioSimSpace.IO: Please install GROMACS (http://www.gromacs.org) &quot;</span>
            <span class="s2">&quot;for GROMACS topology file support.&quot;</span>
        <span class="p">)</span>
        <span class="n">_has_gmx_warned</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Check that the filebase is a string.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filebase</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;filebase&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Check that that the system is of the correct type.</span>

    <span class="c1"># A System object.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_System</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c1"># A Molecule object.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_Molecule</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">_System</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_Molecules</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">toSystem</span><span class="p">()</span>
    <span class="c1"># A list of Molecule objects.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_Molecule</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">system</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">_System</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="c1"># Invalid type.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;system&#39; must be of type &#39;BioSimSpace.SireWrappers.System&#39;, &quot;</span>
            <span class="s2">&quot;&#39;BioSimSpace._SireWrappers.Molecule, &#39;BioSimSpace._SireWrappers.Molecules&#39; &quot;</span>
            <span class="s2">&quot;or a list of &#39;BiSimSpace._SireWrappers.Molecule&#39; types.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check that fileformat argument is of the correct type.</span>

    <span class="c1"># Convert to a list if a single string is passed.</span>
    <span class="c1"># We split on &#39;,&#39; since the user might pass system.fileFormats() as the argument.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileformat</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fileformat</span> <span class="o">=</span> <span class="n">fileformat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="c1"># Lists and tuples are okay!</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileformat</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;fileformat&#39; must be a &#39;str&#39; or a &#39;list&#39; of &#39;str&#39; types.&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure all items in list or tuple are strings.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fileformat</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;fileformat&#39; must be a &#39;str&#39; or a &#39;list&#39; of &#39;str&#39; types.&quot;</span><span class="p">)</span>

    <span class="c1"># Make a list of the matched file formats.</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Make sure that all of the formats are valid.</span>
    <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">fileformat</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">_formats_dict</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">formats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported file format &#39;</span><span class="si">%s</span><span class="s2">&#39;. Supported formats &quot;</span>
                <span class="s2">&quot;are: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_formats</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="c1"># Validate the map.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">property_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;property_map&#39; must be of type &#39;dict&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Copy the map.</span>
    <span class="n">_property_map</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Add the GROMACS topology file path.</span>
    <span class="k">if</span> <span class="n">_gmx_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;GROMACS_PATH&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_property_map</span><span class="p">):</span>
        <span class="n">_property_map</span><span class="p">[</span><span class="s2">&quot;GROMACS_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gmx_path</span>

    <span class="c1"># Get the directory name.</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filebase</span><span class="p">)</span>

    <span class="c1"># If the user has passed a directory, make sure that is exists.</span>
    <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filebase</span><span class="p">)</span> <span class="o">!=</span> <span class="n">filebase</span><span class="p">:</span>
        <span class="c1"># Create the directory if it doesn&#39;t already exist.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
            <span class="n">_os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Store the current working directory.</span>
    <span class="nb">dir</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># Change to the working directory for the process.</span>
    <span class="c1"># This avoid problems with relative paths.</span>
    <span class="k">if</span> <span class="n">dirname</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">_os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

    <span class="c1"># A list of the files that have been written.</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Save the system using each file format.</span>
    <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
        <span class="c1"># Copy an existing file if it exists in the cache.</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">_check_cache</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">filebase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="p">:</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filebase</span> <span class="o">+</span> <span class="n">ext</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="c1"># Add the file format to the property map.</span>
        <span class="n">_property_map</span><span class="p">[</span><span class="s2">&quot;fileformat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SireBase</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>

        <span class="c1"># Warn the user if any molecules are parameterised with a force field</span>
        <span class="c1"># that uses geometric combining rules. While we can write this to file</span>
        <span class="c1"># the information is lost on read.</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;PRM7&quot;</span><span class="p">:</span>
            <span class="c1"># Get the name of the &quot;forcefield&quot; property.</span>
            <span class="n">forcefield</span> <span class="o">=</span> <span class="n">_property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;forcefield&quot;</span><span class="p">,</span> <span class="s2">&quot;forcefield&quot;</span><span class="p">)</span>

            <span class="c1"># Loop over all molecules in the system.</span>
            <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">getMolecules</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="n">forcefield</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">mol</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">forcefield</span><span class="p">)</span><span class="o">.</span><span class="n">combiningRules</span><span class="p">()</span>
                        <span class="o">==</span> <span class="s2">&quot;geometric&quot;</span>
                    <span class="p">):</span>
                        <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                            <span class="s2">&quot;AMBER topology files do not support force fields that &quot;</span>
                            <span class="s2">&quot;use geometric combining rules, as this cannot be specified &quot;</span>
                            <span class="s2">&quot;in the file. When this file is re-read, then arithmetic &quot;</span>
                            <span class="s2">&quot;combining rules will be assumed.&quot;</span>
                        <span class="p">)</span>
                        <span class="c1"># Exit after the first non-arithmetic molecule we encounter.</span>
                        <span class="k">break</span>

        <span class="c1"># Write the file.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Make sure AMBER and GROMACS files have the expected water topology</span>
            <span class="c1"># and save GROMACS files with an extension such that they can be run</span>
            <span class="c1"># directly by GROMACS without needing to be renamed.</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;PRM7&quot;</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;RST7&quot;</span><span class="p">:</span>
                <span class="n">system_copy</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">system_copy</span><span class="o">.</span><span class="n">_set_water_topology</span><span class="p">(</span><span class="s2">&quot;AMBER&quot;</span><span class="p">,</span> <span class="n">_property_map</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">MoleculeParser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">system_copy</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="n">filebase</span><span class="p">,</span> <span class="n">_property_map</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;GroTop&quot;</span><span class="p">:</span>
                <span class="n">system_copy</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">system_copy</span><span class="o">.</span><span class="n">_set_water_topology</span><span class="p">(</span><span class="s2">&quot;GROMACS&quot;</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">MoleculeParser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">system_copy</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="n">filebase</span><span class="p">,</span> <span class="n">_property_map</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;grotop&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">new_file</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_file</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;Gro87&quot;</span><span class="p">:</span>
                <span class="c1"># Write to 3dp by default, unless greater precision is</span>
                <span class="c1"># requested by the user.</span>
                <span class="k">if</span> <span class="s2">&quot;precision&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_property_map</span><span class="p">:</span>
                    <span class="n">_property_map</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SireBase</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">MoleculeParser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">system</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="n">filebase</span><span class="p">,</span> <span class="n">_property_map</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;gro87&quot;</span><span class="p">,</span> <span class="s2">&quot;gro&quot;</span><span class="p">)</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">new_file</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_file</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">MoleculeParser</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                    <span class="n">system</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="n">filebase</span><span class="p">,</span> <span class="n">_property_map</span>
                <span class="p">)</span>

            <span class="n">files</span> <span class="o">+=</span> <span class="n">file</span>

            <span class="c1"># If this is a new file, then add it to the cache.</span>
            <span class="n">_update_cache</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dirname</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to save system to format: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">format</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="c1"># Change back to the original directory.</span>
    <span class="k">if</span> <span class="n">dirname</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">_os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>

    <span class="c1"># Return the list of files.</span>
    <span class="k">return</span> <span class="n">files</span></div>


<div class="viewcode-block" id="savePerturbableSystem"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.savePerturbableSystem.html#BioSimSpace.IO.savePerturbableSystem">[docs]</a><span class="k">def</span> <span class="nf">savePerturbableSystem</span><span class="p">(</span><span class="n">filebase</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a system containing a perturbable molecule. This will be written in</span>
<span class="sd">    AMBER format, with a topology file for each end state of the perturbation,</span>
<span class="sd">    i.e. &#39;filebase0.prm7&#39; and &#39;filebase1.prm7&#39;. Coordinates for the end</span>
<span class="sd">    states are written to &#39;filebase0.rst7&#39; and &#39;filebase1.rst7&#39;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    filebase : str</span>
<span class="sd">        The base name of the output files.</span>

<span class="sd">    system : :class:`System &lt;BioSimSpace._SireWrappers.System&gt;`</span>
<span class="sd">        The molecular system.</span>

<span class="sd">    property_map : dict</span>
<span class="sd">        A dictionary that maps system &quot;properties&quot; to their user defined</span>
<span class="sd">        values. This allows the user to refer to properties with their</span>
<span class="sd">        own naming scheme, e.g. { &quot;charge&quot; : &quot;my-charge&quot; }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that the filebase is a string.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filebase</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;filebase&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Check that the system is valid.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_System</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c1"># A Molecule object.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_Molecule</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">_System</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="c1"># A Molecules object.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_Molecules</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">toSystem</span><span class="p">()</span>
    <span class="c1"># A list of Molecule objects.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_Molecule</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">system</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">_System</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="c1"># Invalid type.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;system&#39; must be of type &#39;BioSimSpace.SireWrappers.System&#39;, &quot;</span>
            <span class="s2">&quot;&#39;BioSimSpace._SireWrappers.Molecule, &#39;BioSimSpace._SireWrappers.Molecules&#39; &quot;</span>
            <span class="s2">&quot;or a list of &#39;BiSimSpace._SireWrappers.Molecule&#39; types.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Validate the map.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">property_map</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;property_map&#39; must be of type &#39;dict&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Validate that there is a single perturbable molecule in the system.</span>
    <span class="n">pert_mols</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">getPerturbableMolecules</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pert_mols</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The &#39;system&#39; must contain a single perturbable molecule. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pert_mols</span><span class="p">)</span><span class="si">}</span><span class="s2">!&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Extract the molecule</span>
    <span class="n">pert_mol</span> <span class="o">=</span> <span class="n">pert_mols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create a copy of the system for the lambda=0 and lambda=1 end states.</span>
    <span class="n">system0</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">system1</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Update the perturbable molecule in each system.</span>
    <span class="n">system0</span><span class="o">.</span><span class="n">updateMolecules</span><span class="p">(</span>
        <span class="n">pert_mol</span><span class="o">.</span><span class="n">_toRegularMolecule</span><span class="p">(</span><span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span><span class="p">,</span> <span class="n">is_lambda1</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">system1</span><span class="o">.</span><span class="n">updateMolecules</span><span class="p">(</span>
        <span class="n">pert_mol</span><span class="o">.</span><span class="n">_toRegularMolecule</span><span class="p">(</span><span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span><span class="p">,</span> <span class="n">is_lambda1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Save the topology files.</span>
    <span class="n">saveMolecules</span><span class="p">(</span><span class="n">filebase</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">system0</span><span class="p">,</span> <span class="s2">&quot;prm7&quot;</span><span class="p">)</span>
    <span class="n">saveMolecules</span><span class="p">(</span><span class="n">filebase</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">system1</span><span class="p">,</span> <span class="s2">&quot;prm7&quot;</span><span class="p">)</span>

    <span class="c1"># Save the coordinate files.</span>
    <span class="n">saveMolecules</span><span class="p">(</span><span class="n">filebase</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">system0</span><span class="p">,</span> <span class="s2">&quot;rst7&quot;</span><span class="p">)</span>
    <span class="n">saveMolecules</span><span class="p">(</span><span class="n">filebase</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">system1</span><span class="p">,</span> <span class="s2">&quot;rst7&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="readPerturbableSystem"><a class="viewcode-back" href="../../../api/generated/BioSimSpace.IO.readPerturbableSystem.html#BioSimSpace.IO.readPerturbableSystem">[docs]</a><span class="k">def</span> <span class="nf">readPerturbableSystem</span><span class="p">(</span><span class="n">top0</span><span class="p">,</span> <span class="n">coords0</span><span class="p">,</span> <span class="n">top1</span><span class="p">,</span> <span class="n">coords1</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a perturbable system from file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    top0 : str</span>
<span class="sd">        The path to the topology file for the lambda=0 end state.</span>

<span class="sd">    coords0 : str</span>
<span class="sd">        The path to the coordinate file for the lambda=0 end state.</span>

<span class="sd">    top1 : str</span>
<span class="sd">        The path to the topology file for the lambda=1 end state.</span>

<span class="sd">    coords1 : str</span>
<span class="sd">        The path to the coordinate file for the lambda=1 end state.</span>

<span class="sd">    property_map : dict</span>
<span class="sd">        A dictionary that maps system &quot;properties&quot; to their user defined</span>
<span class="sd">        values. This allows the user to refer to properties with their</span>
<span class="sd">        own naming scheme, e.g. { &quot;charge&quot; : &quot;my-charge&quot; }</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    system : :class:`System &lt;BioSimSpace._SireWrappers.System&gt;`</span>
<span class="sd">        A molecular system.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top0</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;top0&#39; must be of type &#39;str&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords0</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;coords0&#39; must be of type &#39;str&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;top1&#39; must be of type &#39;str&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;coords1&#39; must be of type &#39;str&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Check that the coordinate and topology files can be parsed.</span>

    <span class="n">prefixes</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">)</span>

    <span class="c1"># Don&#39;t validate URLs.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">top0</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">coords0</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">top1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">coords1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="c1"># lamba = 0 coordinates.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_SireIO</span><span class="o">.</span><span class="n">AmberRst7</span><span class="p">(</span><span class="n">coords0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unable to read lambda=0 coordinate file: </span><span class="si">{</span><span class="n">coords0</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

        <span class="c1"># lamba = 1 coordinates.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_SireIO</span><span class="o">.</span><span class="n">AmberRst7</span><span class="p">(</span><span class="n">coords1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unable to read lambda=1 coordinate file: </span><span class="si">{</span><span class="n">coords1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

        <span class="c1"># lamba = 0 topology.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">AmberPrm</span><span class="p">(</span><span class="n">top0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unable to read lambda=0 topology file: </span><span class="si">{</span><span class="n">top0</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to read topology file for lamba=0 end state: </span><span class="si">{</span><span class="n">top0</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># lamba = 1 topology.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">_SireIO</span><span class="o">.</span><span class="n">AmberPrm</span><span class="p">(</span><span class="n">top1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unable to read lambda=1 topology file: </span><span class="si">{</span><span class="n">top1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">_isVerbose</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to read topology file for lamba=1 end state: </span><span class="si">{</span><span class="n">top1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Try loading the two end states.</span>
    <span class="n">system0</span> <span class="o">=</span> <span class="n">readMolecules</span><span class="p">([</span><span class="n">coords0</span><span class="p">,</span> <span class="n">top0</span><span class="p">],</span> <span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span><span class="p">)</span>
    <span class="n">system1</span> <span class="o">=</span> <span class="n">readMolecules</span><span class="p">([</span><span class="n">coords1</span><span class="p">,</span> <span class="n">top1</span><span class="p">],</span> <span class="n">property_map</span><span class="o">=</span><span class="n">property_map</span><span class="p">)</span>

    <span class="c1"># Make sure the systems have the same number of molecules.</span>
    <span class="k">if</span> <span class="n">system0</span><span class="o">.</span><span class="n">nMolecules</span><span class="p">()</span> <span class="o">!=</span> <span class="n">system1</span><span class="o">.</span><span class="n">nMolecules</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The two topologies contain a different number of molecules!&quot;</span><span class="p">)</span>

    <span class="c1"># Now loop through the molecules in each system to work out which</span>
    <span class="c1"># is the perturbable molecule. This will differ in the  &#39;ambertype&#39;</span>
    <span class="c1"># &#39;LJ&#39; or &#39;charge&#39; property.</span>
    <span class="n">ambertype</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ambertype&quot;</span><span class="p">,</span> <span class="s2">&quot;ambertype&quot;</span><span class="p">)</span>
    <span class="n">LJ</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LJ&quot;</span><span class="p">,</span> <span class="s2">&quot;LJ&quot;</span><span class="p">)</span>
    <span class="n">charge</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="s2">&quot;charge&quot;</span><span class="p">)</span>
    <span class="n">has_pert</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">mol0</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">system0</span><span class="o">.</span><span class="n">getMolecules</span><span class="p">(),</span> <span class="n">system1</span><span class="o">.</span><span class="n">getMolecules</span><span class="p">())</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">atom0</span><span class="p">,</span> <span class="n">atom1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mol0</span><span class="o">.</span><span class="n">getAtoms</span><span class="p">(),</span> <span class="n">mol1</span><span class="o">.</span><span class="n">getAtoms</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">atom0</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">ambertype</span><span class="p">)</span>
                <span class="o">!=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">ambertype</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">atom0</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">LJ</span><span class="p">)</span> <span class="o">!=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">LJ</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">atom0</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>
                <span class="o">!=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">has_pert</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">has_pert</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_pert</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No perturbable molecule was found?&quot;</span><span class="p">)</span>

    <span class="c1"># Extract the perturbable molecule.</span>
    <span class="n">pert_mol</span> <span class="o">=</span> <span class="n">system0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># Extract and copy the Sire molecule.</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">pert_mol</span><span class="o">.</span><span class="n">_sire_object</span><span class="o">.</span><span class="n">__deepcopy__</span><span class="p">()</span>

    <span class="c1"># Make the molecule editable.</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">edit</span><span class="p">()</span>

    <span class="c1"># Rename all properties in the molecule for the lambda=0 end state,</span>
    <span class="c1"># e.g.: &quot;prop&quot; --&gt; &quot;prop0&quot;. Then delete all properties named &quot;prop&quot;</span>
    <span class="c1"># and &quot;prop1&quot;.</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">propertyKeys</span><span class="p">():</span>
        <span class="c1"># See if this property exists in the user map.</span>
        <span class="n">new_prop</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span>

        <span class="c1"># Copy the property using the updated name.</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="n">new_prop</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

        <span class="c1"># Delete the redundant property.</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">removeProperty</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

    <span class="c1"># Now add the properties for the lambda=1 end state.</span>
    <span class="n">mol1</span> <span class="o">=</span> <span class="n">system1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">_sire_object</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">mol1</span><span class="o">.</span><span class="n">propertyKeys</span><span class="p">():</span>
        <span class="c1"># See if this property exists in the user map.</span>
        <span class="n">new_prop</span> <span class="o">=</span> <span class="n">property_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span>

        <span class="c1"># Copy the property using the updated name.</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="n">new_prop</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

    <span class="c1"># Flag that the molecule is perturbable.</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;is_perturbable&quot;</span><span class="p">,</span> <span class="n">_SireBase</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># Add the molecule0 and molecule1 properties.</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;molecule0&quot;</span><span class="p">,</span> <span class="n">system0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">)</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;molecule1&quot;</span><span class="p">,</span> <span class="n">system1</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">_sire_object</span><span class="p">)</span>

    <span class="c1"># Commit the changes.</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">_Molecule</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">commit</span><span class="p">())</span>

    <span class="c1"># Update the molecule in the original system.</span>
    <span class="n">system0</span><span class="o">.</span><span class="n">updateMolecules</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">system0</span></div>


<span class="k">def</span> <span class="nf">_check_cache</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">filebase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal helper function to check whether a Sire system has previously</span>
<span class="sd">    been written to the specified format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    system : sire.legacy.System.System</span>
<span class="sd">        The Sire system.</span>

<span class="sd">    format : str</span>
<span class="sd">        The molecular file format.</span>

<span class="sd">    filebase : str</span>
<span class="sd">        The file base to copy the file to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    extension : str</span>
<span class="sd">        The extension for cached file. False if no file was found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Validate input.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_SireSystem</span><span class="o">.</span><span class="n">System</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;system&#39; must be of type &#39;Sire.System.System&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;format&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filebase</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;filebase&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Create the key.</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">uid</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">version</span><span class="p">()),</span> <span class="nb">format</span><span class="p">)</span>

    <span class="c1"># Get the existing file path and MD5 hash from the cache.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">original_hash</span><span class="p">)</span> <span class="o">=</span> <span class="n">_file_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Whether the cache entry is still valid.</span>
    <span class="n">cache_valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Make sure the file still exists.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">cache_valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Make sure the MD5 sum is still the same.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">current_hash</span> <span class="o">=</span> <span class="n">_get_md5_hash</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
            <span class="n">cache_valid</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># If the cache isn&#39;t valid, delete the entry and return False.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_valid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_file_cache</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">_file_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Copy the old file to the new location.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get the file extension.</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Add the extension to the file base.</span>
        <span class="n">new_path</span> <span class="o">=</span> <span class="n">filebase</span> <span class="o">+</span> <span class="n">ext</span>

        <span class="c1"># Copy the file to the new location.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_shutil</span><span class="o">.</span><span class="n">SameFileError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">ext</span>


<span class="k">def</span> <span class="nf">_update_cache</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal helper function to update the file cache when a new system</span>
<span class="sd">    is written to a specified format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    system : sire.legacy.System.System</span>
<span class="sd">        The Sire system.</span>

<span class="sd">    format : str</span>
<span class="sd">        The molecular file format.</span>

<span class="sd">    path : str</span>
<span class="sd">        The path to the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Validate input.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">_SireSystem</span><span class="o">.</span><span class="n">System</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;system&#39; must be of type &#39;Sire.System.System&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;format&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;path&#39; must be of type &#39;str&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File does not exist: &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to an absolute path.</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Get the MD5 checksum for the file.</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">_get_md5_hash</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Create the key.</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">uid</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">version</span><span class="p">()),</span> <span class="nb">format</span><span class="p">)</span>

    <span class="c1"># Update the cache.</span>
    <span class="n">_file_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_md5_hash</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal helper function to return the MD5 checksum for a file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    hash : hashlib.HASH</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the MD5 hash of the file. Process in chunks in case the file is too</span>
    <span class="c1"># large to process.</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">_hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="nb">hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_patch_sire_load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">property_map</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the molecular system at &#39;path&#39;. This can be a filename</span>
<span class="sd">    of a URL. If it is a URL, then the file will be downloaded</span>
<span class="sd">    to the current directory and loaded from there.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    path : str or list[str]</span>
<span class="sd">        The filename (or names) or the URL or URLS of the molecular</span>
<span class="sd">        system to load. This allows multiple paths to be input</span>
<span class="sd">        as some molecular file formats split molecular information</span>
<span class="sd">        across multiple files. Multiple paths can also be passed</span>
<span class="sd">        as multiple arguments to this function.</span>

<span class="sd">    log : (dict)</span>
<span class="sd">        Optional dictionary that you can pass in that will be populated</span>
<span class="sd">        with any error messages or warnings from the parsers as they</span>
<span class="sd">        attempt to load in the molecular data. This can be helpful</span>
<span class="sd">        in diagnosing why your file wasn&#39;t loaded.</span>

<span class="sd">    show_warnings : bool</span>
<span class="sd">        Whether or not to print out any warnings that are encountered</span>
<span class="sd">        when loading your file(s). This is default True, and may lead</span>
<span class="sd">        to noisy output. Set `show_warnings=False` to silence this output.</span>

<span class="sd">    directory : str</span>
<span class="sd">        Optional directory which will be used when creating any</span>
<span class="sd">        files (e.g. as a download from a URL or which unzipping files)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    system : sire.legacy.System.System:</span>
<span class="sd">        The molecules that have been loaded are returned as</span>
<span class="sd">        a sire.legacy.System.System.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;log&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;silent&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">silent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;silent&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)):</span>
        <span class="c1"># resolve the paths, downloading as needed</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">_sire</span><span class="o">.</span><span class="n">_load</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">)</span>

    <span class="n">paths</span> <span class="o">=</span> <span class="n">p</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;No valid files specified. Nothing to load?&quot;</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">_sire</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_molecules</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="n">_sire</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">create_map</span><span class="p">(</span><span class="n">property_map</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_sire</span><span class="o">.</span><span class="n">_load</span><span class="o">.</span><span class="n">_to_legacy_system</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Feb 07, 2023</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/js/custom.js"></script>
    </body>
</html>